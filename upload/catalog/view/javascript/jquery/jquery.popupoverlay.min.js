/*!
 * jQuery Popup Overlay
 *
 * @version 1.6.0
 * @requires jQuery v1.7.1+
 * @link http://vast-eng.github.com/jquery-popup-overlay/
 */
(function(g){var b=g(window);var q={};var o=[];var d=[];var f=false;var c=false;var m;var n=null;var l=null;var j=null;var a=null;var h="_open";var i="_close";var k=null;var e={_init:function(t){var s=g(t);var r=s.data("popupoptions");d[t.id]=false;o[t.id]=0;if(!s.data("popup-initialized")){s.attr("data-popup-initialized","true");e._initonce(t)}if(r.autoopen){setTimeout(function(){e.show(t,0)},0)}},_initonce:function(s){var u=g("body");var v;var A=$el.data("popupoptions");a=parseInt(u.css("margin-right"),10);if(A.type=="tooltip"){A.background=false;A.scrolllock=false}if(A.scrolllock){var x;var r;if(typeof m==="undefined"){x=g('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");r=x.children();m=r.innerWidth()-r.height(99).innerWidth();x.remove()}}if(!$el.attr("id")){$el.attr("id","j-popup-"+parseInt(Math.random()*100000000))}$el.addClass("popup_content");u.prepend(s);$el.wrap('<div id="'+s.id+'_wrapper" class="popup_wrapper" />');v=g("#"+s.id+"_wrapper");v.css({opacity:0,visibility:"hidden",position:"absolute",overflow:"auto"});$el.css({opacity:0,visibility:"hidden",display:"inline-block"});if(A.setzindex&&!A.autozindex){v.css("z-index","2001")}if(!A.outline){$el.css("outline","none")}if(A.transition){$el.css("transition",A.transition);v.css("transition",A.transition)}g(s).attr("aria-hidden",true);if((A.background)&&(!g("#"+s.id+"_background").length)){var y='<div id="'+s.id+'_background" class="popup_background"></div>';u.prepend(y);var w=g("#"+s.id+"_background");w.css({opacity:0,visibility:"hidden",backgroundColor:A.color,position:"fixed",top:0,right:0,bottom:0,left:0});if(A.setzindex&&!A.autozindex){w.css("z-index","2000")}if(A.transition){w.css("transition",A.transition)}}if(A.type=="overlay"){$el.css({textAlign:"left",position:"relative",verticalAlign:"middle"});v.css({position:"fixed",top:0,right:0,left:0,bottom:0,textAlign:"center"});v.append('<div class="popup_align" />');g(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})}$el.attr("role","dialog");var t=(A.openelement)?A.openelement:("."+s.id+h);g(t).each(function(B,C){g(C).attr("data-popup-ordinal",B);if(!g(C).attr("id")){g(C).attr("id","open_"+parseInt((Math.random()*100000000),10))}});if(!($el.attr("aria-labelledby")||$el.attr("aria-label"))){$el.attr("aria-labelledby",g(t).attr("id"))}g(document).on("click",t,function(C){if(!($el.data("popup-visible"))){var B=g(this).data("popup-ordinal");setTimeout(function(){e.show(s,B)},0);C.preventDefault()}});var z=(A.closeelement)?A.closeelement:("."+s.id+i);g(document).on("click",z,function(B){e.hide(s);B.preventDefault()});if(A.detach){$el.hide().detach()}else{v.hide()}},show:function(s,x){var B=g(s);if(B.data("popup-visible")){return}if(!B.data("popup-initialized")){e._init(s)}B.attr("data-popup-initialized","true");var t=g("body");var C=B.data("popupoptions");var w=g("#"+s.id+"_wrapper");var z=g("#"+s.id+"_background");p(s,x,C.beforeopen);d[s.id]=x;if(C.detach){w.prepend(s);B.show()}else{w.show()}setTimeout(function(){w.css({visibility:"visible",opacity:1});g("html").addClass("popup_visible").addClass("popup_visible_"+s.id);B.addClass("popup_content_visible")},20);B.css({visibility:"visible",opacity:1});if(C.scrolllock){t.css("overflow","hidden");if(t.height()>b.height()){t.css("margin-right",a+m)}}setTimeout(function(){if(!f){if(C.keepfocus){g(document).on("focusin",n)}if(C.blur){g(document).on("click",l)}if(C.escape){g(document).on("keydown",j)}}if(!f){f=true}else{c=true}},0);B.data("popup-visible",true);e.reposition(s,x);if(C.background){z.css({visibility:"visible",opacity:C.opacity});setTimeout(function(){z.css({opacity:C.opacity})},0)}k=document.activeElement;if(C.keepfocus){B.attr("tabindex",-1);setTimeout(function(){if(C.focuselement){g(C.focuselement).focus()}else{B.focus()}},C.focusdelay);n=function(E){var D=document.getElementById(s.id);E.stopPropagation();D.focus()}}if(C.autozindex){var r=document.getElementsByTagName("*");var v=r.length;var A=0;for(var u=0;u<v;u++){var y=g(r[u]).css("z-index");if(y!=="auto"){y=parseInt(y);if(A<y){A=y}}}o[s.id]=A;if(o[s.id]>0){w.css({zIndex:(o[s.id]+2)})}if(C.background){if(o[s.id]>0){g("#"+s.id+"_background").css({zIndex:(o[s.id]+1)})}}}if(C.blur){l=function(D){if(!g(D.target).parents().andSelf().is("#"+s.id)){e.hide(s)}}}if(C.escape){j=function(D){if(D.keyCode==27&&B.data("popup-visible")){e.hide(s)}}}g(C.pagecontainer).attr("aria-hidden",true);B.attr("aria-hidden",false);w.one("transitionend",function(){p(s,x,C.opentransitionend)});p(s,x,C.onopen)},hide:function(u){var w=g("body");var t=g(u);var s=t.data("popupoptions");var v=g("#"+u.id+"_wrapper");var r=g("#"+u.id+"_background");t.data("popup-visible",false);if(c){g("html").removeClass("popup_visible_"+u.id);c=false}else{g("html").removeClass("popup_visible").removeClass("popup_visible_"+u.id);f=false}t.removeClass("popup_content_visible");if(s.scrolllock){setTimeout(function(){w.css({overflow:"visible","margin-right":a})},10)}if(s.blur){g(document).off("click",l)}if(s.keepfocus){g(document).off("focusin",n);setTimeout(function(){if(g(k).is(":visible")){k.focus()}},0)}if(s.escape){g(document).off("keydown",j)}v.css({visibility:"hidden",opacity:0});t.css({visibility:"hidden",opacity:0});if(s.background){r.css({visibility:"hidden",opacity:0})}t.one("transitionend",function(x){if(!(t.data("popup-visible"))){if(s.detach){t.hide().detach()}else{v.hide()}}if(!s.notransitiondetach){p(u,d[u.id],s.closetransitionend)}});if(s.notransitiondetach){if(s.detach){t.hide().detach()}else{v.hide()}}g(s.pagecontainer).attr("aria-hidden",false);t.attr("aria-hidden",true);p(u,d[u.id],s.onclose)},toggle:function(s,r){if($el.data("popup-visible")){e.hide(s)}else{setTimeout(function(){e.show(s,r)},0)}},reposition:function(r,v){var y=g(r);var z=y.data("popupoptions");var u=g("#"+r.id+"_wrapper");var x=g("#"+r.id+"_background");v=v||0;if(z.type=="tooltip"){u.css({position:"absolute"});var s=(z.openelement)?z.openelement:("."+r.id+h);var t=g(s+'[data-popup-ordinal="'+v+'"]');var w=t.offset();if(z.horizontal=="right"){u.css("left",w.left+t.outerWidth()+z.offsetleft)}else{if(z.horizontal=="leftedge"){u.css("left",w.left+t.outerWidth()-t.outerWidth()+z.offsetleft)}else{if(z.horizontal=="left"){u.css("right",g(window).width()-w.left-z.offsetleft)}else{if(z.horizontal=="rightedge"){u.css("right",g(window).width()-w.left-t.outerWidth()-z.offsetleft)}else{u.css("left",w.left+(t.outerWidth()/2)-(y.outerWidth()/2)-parseFloat(y.css("marginLeft"))+z.offsetleft)}}}}if(z.vertical=="bottom"){u.css("top",w.top+t.outerHeight()+z.offsettop)}else{if(z.vertical=="bottomedge"){u.css("top",w.top+t.outerHeight()-y.outerHeight()+z.offsettop)}else{if(z.vertical=="top"){u.css("bottom",g(window).height()-w.top-z.offsettop)}else{if(z.vertical=="topedge"){u.css("bottom",g(window).height()-w.top-y.outerHeight()-z.offsettop)}else{u.css("top",w.top+(t.outerHeight()/2)-(y.outerHeight()/2)-parseFloat(y.css("marginTop"))+z.offsettop)}}}}}else{if(z.type=="overlay"){if(z.horizontal){u.css("text-align",z.horizontal)}else{u.css("text-align","center")}if(z.vertical){y.css("vertical-align",z.vertical)}else{y.css("vertical-align","middle")}}}}};var p=function(t,r,u){var s=(q.openelement)?q.openelement:("."+t.id+h);var v=g(s+'[data-popup-ordinal="'+r+'"]');if(typeof u=="function"){u(v)}};g.fn.popup=function(r){return this.each(function(){$el=g(this);if(typeof r==="object"){var s=g.extend({},g.fn.popup.defaults,r);$el.data("popupoptions",s);q=$el.data("popupoptions");e._init(this)}else{if(typeof r==="string"){if(!($el.data("popupoptions"))){$el.data("popupoptions",g.fn.popup.defaults);q=$el.data("popupoptions")}e[r].call(this,this)}else{if(!($el.data("popupoptions"))){$el.data("popupoptions",g.fn.popup.defaults);q=$el.data("popupoptions")}e._init(this)}}})};g.fn.popup.defaults={type:"overlay",autoopen:false,background:true,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:true,blur:true,setzindex:true,autozindex:false,scrolllock:false,keepfocus:true,focuselement:null,focusdelay:50,outline:false,pagecontainer:null,detach:false,openelement:null,closeelement:null,transition:null,notransitiondetach:false,beforeopen:function(){},onclose:function(){},onopen:function(){},opentransitionend:function(){},closetransitionend:function(){}}})(jQuery);